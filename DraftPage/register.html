<!doctype html>
<html lang="en">
    <head>
        <title>Register</title>
        <link rel="icon" href="icon.svg">
        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>
    
    </head>
    <body style="align-items: center;padding-top: 10px; background-image:url('sign.jpg');background-size:cover;background-position:0% 20%;">
      <h1 class="text-center" style="padding-top: 30px;">
        <svg xmlns="http://www.w3.org/2000/svg" width="42" height="42" fill="currentColor" class="bi bi-calendar4-range" viewBox="0 0 16 16">
          <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM2 2a1 1 0 0 0-1 1v1h14V3a1 1 0 0 0-1-1H2zm13 3H1v9a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V5z"/>
          <path d="M9 7.5a.5.5 0 0 1 .5-.5H15v2H9.5a.5.5 0 0 1-.5-.5v-1zm-2 3v1a.5.5 0 0 1-.5.5H1v-2h5.5a.5.5 0 0 1 .5.5z"/>
        </svg>
        Gathable
      </h1>
      
      <form style="width: 100%;max-width: 600px;padding:40px 60px;margin: auto;border-radius: 40px;background-color:rgba(255, 255, 255, 0.8);">
        <h2 class="text-center mb-2 fw-normal">Register</h2>
        <label for="username" class="mb-3">Name</label>
        <div class="input-group">
            <input id="username" class="form-control mb-3" placeholder="Name" required>
            <span class="input-group-text mb-3" id="basic-addon1">@</span>
        </div>
          
        <div id="alert" class="alert alert-danger mt-2 mb-3" role="alert" style="display:none;"></div>
          
        <label for="email" class="mb-3">Email Address</label>
        <input type="email" id="email" class="form-control mb-3" placeholder="Email Address" required>
        <label for="password" class="mb-3">Password</label>
        <input type="password" id="password" class="form-control mb-3" placeholder="Password" required>
        <label for="cpassword" class="mb-3">Confirm password</label>
        <input type="password" id="cpassword" class="form-control mb-3" placeholder="Confirm password" required>
        <div class="d-flex justify-content-center mb-3">
        <button class="btn btn-primary btn-lg w-75" id="registerb" style="border-radius: 24px;">Register</button>
        </div>
        <p class="small text-center">Already have an account? <a href="./sign_in.html" target="_blank">Sign in</a> here</p>
        <p class="mt-5 mb-3 text-muted text-center">&copy; Gathable</p>
      </form>
      <footer class="text-end text-light p-2 mt-5" style="background-color: #2c2c2c;">
        This website was updated on <time>2021-03-18</time>. <b>&copy; Gathable</b>
      </footer>
        
    <script src="func.js"></script>

    <script>
        <script language = "Javascript">
        pingServer();
        checkLogin(function() {
        alert('You are currently logged in!');
        window.location.href = "index.html";
        });
        
        var register = document.getElementById('registerb');
        
        register.onclick = function() {
            var warningT = document.getElementById('alert');
            var usernamei = document.getElementById('username').value;
            var emaili = document.getElementById('email').value;
            var passwordi = document.getElementById('password').value;
            var cpasswordi = document.getElementById('cpassword').value;
    
            if (usernamei.length < 6 || usernamei.length > 20) {
                //checking username structure.
                warningT.innerHTML = 'The username should between 6-20 characters!';
                warningT.style.display = 'block';
            } else if (! (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(emaili))) {
                // Check if valid email.
                warningT.innerHTML = 'The email format is incorrect!';
                warningT.style.display = 'block';
                return;
            } else if (passwordi !== cpasswordi) {
                // Check password match.
                warningT.innerHTML = 'The confirmed password does not match!';
                warningT.style.display = 'block';
            } else if (passwordi.length < 6 || passwordi.length > 20) {
                // Check password validity.
                warningT.innerHTML = 'The password should between 6-20 characters!';
                warningT.style.display = 'block';
            } else {
                // Client side check completed.
                register.innerHTML = 'Registering...';
                register.setAttribute('disabled', '');

                var postBody = JSON.stringify({
                    username: usernamei,
                    verified: 1,
                    password: passwordi,
                    email: emaili
                });

                // POST to the server.
                $.post(serverAddr + '/register', postBody, function(data, status) {
                    //implement verification email here!
                    
                    
                    alert('Registration Succeeded! Please verify account through your email!');
                    window.location.href = 'index.html';
                }).fail(function(xhr, status, error) {
                    if (xhr.responseText != '') {
                        warningT.innerHTML = 'Registration failed: ' + JSON.parse(xhr.responseText)['error'] + '.';
                        warningT.style.display = 'block';
                    } else {
                        warningT.innerHTML = 'Registration failed with unknown reason, please try again!';
                        warningT.style.display = 'block';
                    }
            
                    register.innerHTML = 'Register';
                    register.removeAttribute('disabled');
                });
                }

                };
   
    </script>
    </body>
</html>
